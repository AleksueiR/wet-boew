/*!
 *
 * Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW)
 * wet-boew.github.com/wet-boew/License-eng.txt / wet-boew.github.com/wet-boew/Licence-fra.txt
 *
 * Version: @wet-boew-build.version@
 *
 */
(function(e){"use strict";e.fn.datalist=function(){return e(this).each(function(t){var i,n,o,a,s,r,l=e(this),c=e("#"+l.attr("list")),u=[];o=function(t){var o,a;0!==t.length?(o=t.toLowerCase(),a=n.filter(function(){var t=e(this),i=t.find("span.al-value").html();return 0===i.length&&(i=t.find("span.al-label").html()),0===o.length||-1!==i.toLowerCase().indexOf(o)})):a=n,i.empty().append(a),0!==a.length?(s(),i.removeClass("al-hide"),l.attr("aria-expanded","true")):(i.addClass("al-hide"),l.attr("aria-expanded","false"))},a=function(){i.addClass("al-hide").empty(),l.attr({"aria-expanded":"false","aria-activedescendent":""})},s=function(){i.css("width",l.innerWidth()),pe.ie>0&&8>pe.ie&&i.css("top",l.innerHeight()+13)},pe.resize(s),c.find("option").each(function(i){var n=e(this),o=n.attr("value"),a=n.attr("label");"undefined"===o&&(o=n.text()),u.push('<li class="al-option" id="al-option-'+t+"-"+i+'"><a href="javascript:;"><span class="al-value">'+("undefined"!==o?o:"")+'</span><span class="al-label">'+("undefined"!==a?a:"")+"</span></a></li>")}),l.attr({autocomplete:"off",role:"textbox","aria-haspopup":"true","aria-autocomplete":"list","aria-owns":"wb-autolist-"+t,"aria-activedescendent":""}).wrap('<div class="wb-al-container" role="application"/>'),r=l.parent(),i=e('<ul role="listbox" id="wb-autolist-'+t+'" class="wb-autolist al-hide" aria-hidden="true" aria-live="polite"></ul>'),n=e(u.join("")),l.after(i),l.on("keyup keydown click vclick touchstart focus",function(e){var t,n=e.type,s=e.keyCode;if("keyup"===n)e.ctrlKey||e.altKey||e.metaKey||(s>47&&58>s||s>64&&91>s||32===s||8===s)&&o(l.val());else if("keydown"===n){if(!e.ctrlKey&&!e.metaKey)if(e.altKey||i.hasClass("al-hide")){if(38===s||40===s)return o(""),!1}else{if(27===s)return a(),!1;if((38===s||40===s)&&""===l.attr("aria-activedescendent"))return t=38===s?i.find("a").last():i.find("a").eq(0),l.attr("aria-activedescendent",t.parent().attr("id")),pe.focus(t),!1}}else{if("click"===n||"vclick"===n)return i.hasClass("al-hide")||a(),!1;"focus"===n&&pe.ie>0&&8>pe.ie&&i.addClass("al-hide").empty()}}),i.on("keyup keydown click vclick touchstart","a, span",function(t){var n,s,r,c,u=t.type,d=t.keyCode,h=e(t.target),p=l.val();if("keyup"===u)t.ctrlKey||t.altKey||t.metaKey||(d>47&&58>d||d>64&&91>d||32===d?(l.val(p+String.fromCharCode(d)),pe.focus(l),o(l.val())):8===d&&(l.val().length>0&&(l.val(p.substring(0,p.length-1)),o(l.val())),pe.focus(l)));else if("keydown"===u){if(!(t.ctrlKey||t.altKey||t.metaKey)){if(13===d)return c=h.find("span.al-value").html(),0===c.length&&(c=h.find("span.al-label").html()),l.val(c),pe.focus(l),a(),!1;if(9===d||27===d)return pe.focus(l),a(),!1;if(38===d||40===d)return n=i.find("a"),0!==n.length&&(s=n.index(h),r=38===d?-1===s-1?n.last():n.eq(s-1):s+1===n.length?n.eq(0):n.eq(s+1),l.attr("aria-activedescendent",r.parent().attr("id")),pe.focus(r)),!1}}else("click"===u||"vclick"===u||"touchstart"===u)&&(h.hasClass("al-option")||(h=h.parent()),c=h.find("span.al-value").html(),0===c.length&&(c=h.find("span.al-label").html()),l.val(c),pe.focus(l),a())}),pe.document.on("click vclick touchstart",function(t){i.hasClass("al-hide")||e(t.target).is(l)||a()})})},e("input[list]").datalist()})(jQuery);