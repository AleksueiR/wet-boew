/*!
 *
 * Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW)
 * wet-boew.github.com/wet-boew/License-eng.txt / wet-boew.github.com/wet-boew/Licence-fra.txt
 *
 * Version: @wet-boew-build.version@
 *
 */
(function(e){"use strict";var t;e.fn.datepicker=function(){return e(this).each(function(){var i,n,a,o,s,r,l,c,u,d,h,p,f=pe.fn.calendar,m=new Date,g="YYYY-MM-DD",b=m.getMonth(),v=m.getFullYear(),y=e(this),x=y.parent();y.hasClass("picker-field")||(y.addClass("picker-field"),a=function(i){var n=x.find('label[for="'+i+'"]').text(),a=e('<a id="'+i+'-picker-toggle" class="picker-toggle-hidden" href="javascript:;"><img class="image-actual" src="'+pe.add.liblocation+'images/datepicker/calendar-month.png" alt="'+pe.dic.get("%datepicker-show")+n+'"/></a>');a.on("click vclick touchstart",function(){return p(i),!1}),y.after(a),t.slideUp(0)},i=function(i,a,o,s,r,l,c){var u,f,m=t.parent().find("#"+i);r=void 0!==m.attr("min")?m.attr("min"):"1800-01-01",l=void 0!==m.attr("max")?m.attr("max"):"2100-01-01",r=pe.date.from_iso_format(r),l=pe.date.from_iso_format(l),u=a===r.getFullYear()&&o===r.getMonth(),f=a===l.getFullYear()&&o===l.getMonth(),s.each(function(t,m){if(!u&&!f||u===!0&&t>=r.getDate()||f===!0&&l.getDate()>=t){var g=e(m).children("div"),b=e('<a href="javascript:;"></a>'),v=g.parent();v.empty(),b.append(g.html()),b.appendTo(v),b.on("keydown",function(n){var s=e(this).closest(".cal-container"),c=s.attr("id");if(n.ctrlKey||n.altKey||n.metaKey){if(n.ctrlKey&&!n.altKey&&!n.metaKey)switch(n.keyCode){case 35:return d(c,a,o,r,l,new Date(a,11,31)),!1;case 36:return d(c,a,o,r,l,new Date(a,0,1)),!1}}else switch(n.keyCode){case 27:return p(i),!1;case 32:return e(this).trigger("click"),!1;case 33:return n.shiftKey?d(c,a,o,r,l,new Date(a-1,o,t+1)):d(c,a,o,r,l,new Date(a,o-1,t+1)),!1;case 34:return n.shiftKey?d(c,a,o,r,l,new Date(a+1,o,t+1)):d(c,a,o,r,l,new Date(a,o+1,t+1)),!1;case 35:return pe.focus(e(this).closest("ol").children("li").children("a").last()),!1;case 36:return pe.focus(e(this).closest("ol").children("li").children("a").first()),!1;case 37:return d(c,a,o,r,l,new Date(a,o,t)),!1;case 38:return d(c,a,o,r,l,new Date(a,o,t-6)),!1;case 39:return d(c,a,o,r,l,new Date(a,o,t+2)),!1;case 40:return d(c,a,o,r,l,new Date(a,o,t+8)),!1}}),b.on("click vclick touchstart",{fieldid:i,year:a,month:o,day:t+1,days:s,format:c},function(e){return n(e.data.fieldid,e.data.year,e.data.month+1,e.data.day,e.data.format),h(e.data.fieldid,e.data.year,e.data.month,e.data.days,e.data.format),p(e.data.fieldid),!1})}})},d=function(t,i,n,a,o,s){s.getTime()<a.getTime()?(s=a,s.setDate(s.getDate()+1)):s.getTime()>o.getTime()&&(s=o,s.setDate(s.getDate()+1)),(s.getMonth()!==n||s.getFullYear()!==i)&&f.create(t,s.getFullYear(),s.getMonth(),!0,a,o),pe.focus(e("#"+t).find(".cal-day-list").children("li:eq("+(s.getDate()-1)+")").children("a"))},h=function(t,i,n,a,o){var s,r,l,c;e(a).removeClass("datepicker-selected"),e(a).find(".datepicker-selected-text").detach(),o=o.replace("DD","(?<a> [0-9]{2})"),o=o.replace("D","(?<a> [0-9] )"),o=o.replace("MM","(?<b> [0-9]{2})"),o=o.replace("M","(?<b> [0-9])"),o=o.replace("YYYY","(?<c> [0-9]{4})"),o=o.replace("YY","(?<c /> [0-9]{2})"),s="^"+o+"$",r=e("#"+t).val(),c=new XRegExp(s,"x");try{""!==r&&(l=e.parseJSON(r.replace(c,'{"year":"$1", "month":"$2", "day":"$3"}')),parseInt(l.year,10)===i&&parseInt(l.month,10)===n+1&&(e(a[l.day-1]).addClass("datepicker-selected"),e(a[l.day-1]).children("a").append('<span class="wb-invisible datepicker-selected-text"> ['+pe.dic.get("%datepicker-selected")+"]</span>")))}catch(u){}},n=function(e,i,n,a,s){t.parent().find("#"+e).val(o(i,n,a,s))},p=function(i){var n=e("#"+i),a=n.parent(),o=a.find("#"+i+"-picker-toggle");o.toggleClass("picker-toggle-hidden picker-toggle-visible"),u=void 0!==n.attr("min")?n.attr("min"):"1800-01-01",c=void 0!==n.attr("max")?n.attr("max"):"2100-01-01",t.attr({"aria-labelledby":i+"-picker-toggle","aria-controls":i}),f.create("wb-picker",v,b,!0,u,c),n.after(t),t.unbind("focusout.calendar"),t.unbind("focusin.calendar"),o.hasClass("picker-toggle-visible")?(r(i),t.find("a").attr("tabindex",0),t.slideDown("fast",function(){l(e(this))}),t.attr("aria-hidden","false"),o.children("a").children("span").text(pe.dic.get("%datepicker-hide")),0!==t.find(".cal-prevmonth a").length?pe.focus(t.find(".cal-prevmonth a")):0!==t.find(".cal-nextmonth a").length?pe.focus(t.find(".cal-nextmonth a")):pe.focus(t.find(".cal-goto a"))):(s(e("#"+i)),pe.focus(a.find("#"+i)))},r=function(t){e(".picker-field").each(function(){e(this).attr("id")!==t&&s(e(this))})},s=function(i){var n,a,o;n=i.attr("id"),a=e("#"+n+"-picker-toggle"),o=e('label[for="'+n+'"]').text(),t.find("a").attr("tabindex","-1"),t.slideUp("fast",function(){l(e(this))}),t.attr("aria-hidden","true"),f.hideGoToForm("wb-picker"),a.children("a").children("span").text(pe.dic.get("%datepicker-show")+o),a.removeClass("picker-toggle-visible"),a.addClass("picker-toggle-hidden")},l=function(t){var i,n=e("#wb-main-in");7===pe.ie?(i=t.height()+t.offset().top-n.offset().top+50,n.height()>=i?n.css("min-height",""):i>n.height()&&n.css("min-height",i)):pe.ie>0&&7>pe.ie&&(i=t.height()+t.offset().top-n.offset().top+50,n.height()>=i?n.css("height",""):i>n.height()&&n.css("height",i))},o=function(e,t,i,n){var a=n;return a=a.replace("DD",pe.string.pad(i,2)),a=a.replace("D",i),a=a.replace("MM",pe.string.pad(t,2)),a=a.replace("M",t),a=a.replace("YYYY",e),a=a.replace("YY",(""+e).substr(2,2))},void 0===t&&(t=e('<div id="wb-picker" class="picker-overlay" role="dialog" aria-hidden="true"></div>'),t.on("keyup",function(e){27===e.keyCode&&(r(),pe.focus(t.parent().find("#"+t.attr("aria-controls"))))}),t.on("calendarDisplayed",function(t,n,a,o){var s=e(this),r=s.attr("aria-controls");i(r,n,a,o,u,c,g),h(r,n,a,o,g),s.on("click vclick touchstart focusin",function(e){e.stopPropagation?e.stopImmediatePropagation():e.cancelBubble=!0})}),pe.document.on("click vclick touchstart focusin",function(){return"false"===t.attr("aria-hidden")?(s(t.parent().find("#"+t.attr("aria-controls"))),!1):void 0}),e('<a class="picker-close" role="button" href="javascript:;"><img src="'+pe.add.liblocation+'images/datepicker/cross-button.png" alt="'+pe.dic.get("%datepicker-hide")+'" class="image-actual" /></a>').appendTo(t).click(function(){p(t.attr("aria-controls"))}),t.find("a").attr("tabindex","-1"),pe.bodydiv.after(t)),void 0!==y.attr("id")&&a(y.attr("id")))})},e('input[type="date"]').datepicker()})(jQuery);